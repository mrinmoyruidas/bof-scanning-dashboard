const fileInput=document.getElementById("fileInput"),vesselFilter=document.getElementById("vesselFilter"),applyFilter=document.getElementById("applyFilter");let jsonData=[],choices;function initializeChoices(){choices=new Choices(vesselFilter,{removeItemButton:!0,searchEnabled:!0,placeholder:!0,placeholderValue:"Select campaigns"})}function updateVesselFilterOptions(e){const t=[...new Set(e.map(e=>e["Vessel campaign"]))];choices.clearChoices(),t.forEach(e=>{choices.setChoices([{value:e,label:e}],"value","label",!1)})}function filterDataByVessel(e){const t=choices.getValue(!0);return 0===t.length?e:e.filter(e=>t.includes(e["Vessel campaign"]))}function generateChart(e,t,a,n,l){const i={};t.forEach(e=>{const t=e["Vessel campaign"];i[t]||(i[t]={x:[],y:[]}),i[t].x.push(e[a]),i[t].y.push(e[n])});const r=Object.keys(i).map(e=>({x:i[e].x,y:i[e].y,mode:"lines+markers",name:e})),s={title:l,xaxis:{title:a,showline:!0,zeroline:!0},yaxis:{title:n,range:[0,1600],showline:!0,zeroline:!0},hovermode:"closest"};Plotly.newPlot(e,r,s)}function generateCharts(e){generateChart("chart1",e,"LIFE","CHARGE PAD","Life vs Charge Pad"),generateChart("chart2",e,"LIFE","TAP PAD","Life vs Tap Pad"),generateChart("chart3",e,"LIFE","DE Trunnion","Life vs DE Trunnion"),generateChart("chart4",e,"LIFE","NDE Trunnion","Life vs NDE Trunnion"),generateChart("chart5",e,"LIFE","DE Knuckle","Life vs DE Knuckle"),generateChart("chart6",e,"LIFE","NDE Knuckle","Life vs NDE Knuckle"),generateChart("chart7",e,"LIFE","BOTTOM","Life vs Bottom")}fileInput.addEventListener("change",e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=()=>{try{if(t.name.endsWith(".json"))jsonData=JSON.parse(e.result);else{const a=new Uint8Array(e.result),n=XLSX.read(a,{type:"array"}),l=n.SheetNames[0];jsonData=XLSX.utils.sheet_to_json(n.Sheets[l])}updateVesselFilterOptions(jsonData),generateCharts(jsonData)}catch(e){alert("Error processing file. Please upload a valid JSON or Excel file.")}},t.name.endsWith(".json")?e.readAsText(t):e.readAsArrayBuffer(t)}}),applyFilter.addEventListener("click",()=>{const e=filterDataByVessel(jsonData);generateCharts(e)}),document.addEventListener("DOMContentLoaded",initializeChoices);
